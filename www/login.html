<html>
	<head>
			<title>
					Esparto Login
			</title>
			<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
			<script type="text/javascript">
				$(document).ready(function(){
					$("#submit").click(function(){
						$.ajax({
							url:'http://localhost:3000/login',
							headers: {
								'Authorization': 'Basic ' + window.btoa($("#username").val() + ":" + $("#password").val())
							}
						}).done(function(data, status, xhr){
							console.log('success', arguments);
							var headers = xhr.getAllResponseHeaders().split("\n");
							var h = {};
							for (var i = 0, L = headers.length; i < L; i++) {
								if(headers[i].length === 0) continue;
								var colonPos = headers[i].indexOf(':');
								h[headers[i].substring(0, colonPos)] = headers[i].substring(colonPos+1, headers[i].length);
							}
							var head = {};
							head['X-CS-Auth'] = h['X-CS-Auth']  
							$.ajaxSetup({
								headers: head
							});
							//$('#content').html(arguments);
							window.location = "/catalog.html"
						}).fail(function(){
							console.log('fail', arguments);
							$('#content').html(arguments[2]);
						});
					});
				});
			</script>
	</head>
	<body>
		<h2>Esparto Login</h2>
		<h1>This is esparto!</h1>
		<img src="http://www.pisitoenmadrid.com/fotolog/images/20090325163658_this-is-sparto.jpg" />
		<table border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td>
					User Name:
				</td>
				<td>
					<input type="text" name="username" id="username">
				</td>
			</tr>
			<tr>
				<td>
					Password:
				</td>
				<td>
					<input type="text" name="password" id="password">
				</td>
			</tr>
			<tr>
				<td>
					<button id="submit">Login</button>
				</td>
				<td>
					<div id="content"></div>
				</td>
			</tr>
		</table>
	</body>
</html>
